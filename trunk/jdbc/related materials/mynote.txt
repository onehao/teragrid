@author onehao 


24. 使用JDBC调用存储过程
CallableStatement （从PreparedStatement扩展来）
cs = connection.prepareCall("{call psname(?,?,?)}");
cs.registerOutParameter(index,Types.INTEGER);
cs.setXXX(i,xxxx);
cs.executeUpdate();
int id=cs.getInt(index);

PreparedStatement 
PsTest.java
String sql = "{call addUser(?,?,?,?)}";
			cs = conn.prepareCall(sql);
			cs.registerOutParameter(4, Types.INTEGER);
			cs.setString(1, "ps name");
			cs.setDate(2, new java.sql.Date(System.currentTimeMillis()));
			cs.setFloat(3, 100f);
			
			
OtherApi.java
ps = conn.prepareStatement(sql,Statement.RETURN_GENERATED_KEYS);
			ps.executeUpdate();
			
			rs = ps.getGeneratedKeys();//可能主键不是整数，或者复合主键，所以返回rs
			int id = 0;
			if(rs.next()){
				id = rs.getInt(1);
			}
	
	
	
25.使用JDBC的批处理功能	

	static void createBatch() throws SQLException{
		Connection conn = null;
		PreparedStatement ps = null;
		ResultSet rs = null;
		try {
			//2.建立连接
			conn = JdbcUtils.getConnection(); //推荐 代码不罗嗦
			//conn = JdbcUtilsSingleton.getInstance().getConnection();//单例模式实现
			String sql = "insert into user(username,birthday,money) values(?,?,?)";
			
			ps = conn.prepareStatement(sql,Statement.RETURN_GENERATED_KEYS);
			for(int i = 0;i < 1000;i++){
				ps.setString(1, "batchname" + i);
				ps.setDate(2, new Date(System.currentTimeMillis()));
				ps.setFloat(3, 100f + i);
				
				ps.addBatch();
			}
			int [] is = ps.executeBatch();
		} finally {
			JdbcUtils.free(rs, ps, conn);
		}
	}
	
time:
create:34938
createBatch:25171
	
26.可滚动结果集与分页技术
1).不支持分页的数据库
rs = st.executeQuery("select id,username,password,groups from user");
//数据库不支持分页查询的时候用
			rs.absolute(5);
			int i = 0;
			while(rs.next()&& i<3){
				System.out.println("id: "+rs.getInt("id") 
						+ "\tusername: " + rs.getString("username") 
						+ "\tpassword: " + rs.getString("password")
						+ "\tgroups: " + rs.getString("groups"));
			}
2).支持分页的数据库
rs = st.executeQuery("select id,username,password,groups from user limit 5,3");//mysql 支持分页


27.可更新和对更新敏感的结果集
st = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,ResultSet.CONCUR_UPDATABLE);
if("otherapi1".equals(name)){
					rs.updateFloat("money", 300f);
					rs.updateRow();
				}
				


28.数据库的元数据信息
对于hibernate框架很有用
Connection conn = JdbcUtils.getConnection();
		DatabaseMetaData dbmd = conn.getMetaData();
		System.out.println("db name: " + dbmd.getDatabaseProductName());
		System.out.println("tx: " + dbmd.supportsTransactions());
		conn.close();
		
		
		
		
		



